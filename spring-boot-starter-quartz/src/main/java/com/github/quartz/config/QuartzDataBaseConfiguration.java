package com.github.quartz.config;import com.github.quartz.PropertyPlaceholder;import com.github.quartz.jdbc.QuartzRepository;import com.github.quartz.schedule.SqlScriptExecute;import com.github.quartz.schedule.util.QuartzUtil;import org.quartz.impl.jdbcjobstore.Constants;import org.springframework.beans.BeansException;import org.springframework.beans.factory.BeanFactory;import org.springframework.beans.factory.BeanFactoryAware;import org.springframework.boot.autoconfigure.AutoConfigureAfter;import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.context.ApplicationContext;import org.springframework.context.ApplicationContextAware;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.jdbc.core.JdbcOperations;import org.springframework.transaction.PlatformTransactionManager;import org.springframework.util.ObjectUtils;import javax.annotation.Resource;import javax.sql.DataSource;/** * @DESCRIPTION: quartz所需的数据操作类的配置 * @AUTHER: chenmin * @CREATE BY: 18/1/15 下午4:11 */@Configuration@AutoConfigureAfter(QuartzBeanConfiguration.class)@ConditionalOnBean(DataSource.class)@EnableConfigurationProperties(QuartzProperties.class)public class QuartzDataBaseConfiguration implements BeanFactoryAware, ApplicationContextAware {    private ApplicationContext applicationContext;    private BeanFactory beanFactory;    /**     * quartz任务配置表访问类     * @param propertyPlaceholder     * @param jdbcOperations     * @param transactionManager     * @return     */    @Bean    public QuartzRepository quartzRepository(PropertyPlaceholder propertyPlaceholder,                                             JdbcOperations jdbcOperations,                                             PlatformTransactionManager transactionManager) {        Object tablePrefixObj = propertyPlaceholder.getProperty("org.quartz.jobStore.tablePrefix");        String tablePrefix = ObjectUtils.isEmpty(tablePrefixObj) ? Constants.DEFAULT_TABLE_PREFIX : tablePrefixObj.toString();        Object tableSuffixObj = propertyPlaceholder.getProperty("org.quartz.jobStore.tableSuffix");        String tableSuffix = ObjectUtils.isEmpty(tableSuffixObj) ? "" : tableSuffixObj.toString();        return new QuartzRepository(jdbcOperations, transactionManager) //                .setTablePrefix(tablePrefix)    //                .setTableSuffix(tableSuffix);    }    /**     * 创建执行SQL脚本文件的执行器     * @param dataSource     * @param quartzProperties     * @return     */    @Bean    public SqlScriptExecute quartzCleanner(DataSource dataSource, QuartzProperties quartzProperties) {        return new SqlScriptExecute(quartzProperties, dataSource);    }    /**     * Quartz的工具类，支持新增，删除，修改任务     * @param quartzRepository     * @param quartzProperties     * @return     */    @Bean    public QuartzUtil quartzUtil(QuartzRepository quartzRepository, QuartzProperties quartzProperties) {        return new QuartzUtil()                .setConfigurableBeanFactory(beanFactory)                .setQuartzProperties(quartzProperties)                .setApplicationContext(applicationContext)                .setQuartzRepository(quartzRepository);    }    @Override    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {        this.applicationContext = applicationContext;    }    @Override    public void setBeanFactory(BeanFactory beanFactory) throws BeansException {        this.beanFactory = beanFactory;    }}