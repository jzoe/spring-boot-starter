package com.github.quartz.http;import com.alibaba.fastjson.JSONObject;import com.github.quartz.model.entity.QrtzTimedTask;import com.github.quartz.utils.HttpUtil;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.util.ObjectUtils;import org.springframework.util.ReflectionUtils;import javax.servlet.ServletException;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.BufferedReader;import java.io.IOException;import java.io.InputStreamReader;import java.io.PrintWriter;import java.lang.reflect.Method;import static com.github.quartz.model.constant.HttpConstant.*;/** * @DESCRIPTION: Quartz提供对外访问接口 * @AUTHER: chenmin * @CREATE BY: 18/1/13 上午10:51 */public class ScheduleServlet extends HttpServlet {    public static final Logger logger = LoggerFactory.getLogger(ScheduleServlet.class);    private ScheduleExecutor scheduleExecutor;    public void setScheduleExecutor(ScheduleExecutor scheduleExecutor) {        this.scheduleExecutor = scheduleExecutor;    }    @Override    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {        this.doPost(request, response);    }    @Override    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {        BufferedReader br = new BufferedReader(new InputStreamReader(request.getInputStream(), "UTF-8"));        StringBuilder sb = new StringBuilder();        String line;        while ((line = br.readLine()) != null) {            sb.append(line);        }        JSONObject jsonObject = JSONObject.parseObject(sb.toString());        QrtzTimedTask qrtzTimedTask = jsonObject.getObject(QUARTZ_DATA, QrtzTimedTask.class);        JSONObject resultData = new JSONObject();        if (!ObjectUtils.isEmpty(qrtzTimedTask)) {            Method method = null;            try {                method = ReflectionUtils.findMethod(                        scheduleExecutor.getClass(), jsonObject.getString(QUARTZ_METHOD), QrtzTimedTask.class);                ReflectionUtils.invokeMethod(method, scheduleExecutor, qrtzTimedTask);                resultData.put(HTTP_FLAG, HTTP_SUCCESS);            } catch (Exception e) {                logger.error(method + " invoked error", e);                resultData.put(HTTP_FLAG, HTTP_FAILED);                resultData.put(QUARTZ_DATA, e.getMessage());            }        }        response.setCharacterEncoding("UTF-8");        response.setContentType("application/json; charset=utf-8");        PrintWriter pw = response.getWriter();        pw.write(resultData.toJSONString());        HttpUtil.close(pw);    }}